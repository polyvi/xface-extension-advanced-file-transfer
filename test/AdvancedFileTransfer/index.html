<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,height=device-height,user-scalable=no,maximum-scale=1.0,initial-scale=1.0" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"> <!-- ISO-8859-1 -->
    <link rel="stylesheet" href="../master.css" type="text/css" media="screen" title="no title" charset="utf-8">
    <script type="text/javascript" charset="utf-8" src="../base.js"></script>
    <script type="text/javascript" charset="utf-8">
        window.onerror = error;
        function error(sMsg, sUrl, sLine) {
            console.log(sMsg + sUrl + sLine);
            alert(sMsg);
        }
      //var source = "http://c758482.r82.cf2.rackcdn.com/Sublime%20Text%202.0.2%20x64%20Setup.exe";
      //var target = "/fileloadfile/Sublime.exe";
      var source = "http://www.polyvi.net:8012/develop/TrafficStats/chmdecoder.zip";
      var target = "chmdecoder.zip";
      var uploadfile = "test_upload2.rar";
      var uploadServer = "http://polyvi.net:8091/mi/UploadServer";

      function download(){
          var fileTransfer = new xFace.AdvancedFileTransfer(source, target);
        fileTransfer.download(downloadSuccess, downloadFail);
      };

      function pause(){
          var fileTransfer = new xFace.AdvancedFileTransfer(source, target);
        fileTransfer.pause();
      };

      function cancel(){
          var fileTransfer = new xFace.AdvancedFileTransfer(source, target);
        fileTransfer.cancel();
      };

      function downloadSuccess(result){
        if(result.status == "unfinished"){
          var res = "completeSize:" + result.loaded;
          document.getElementById('status').innerText = "downloading";
          document.getElementById('result').innerText = res;
        }else{
          var res = "file: " + result.name + " has been downloaded";
          document.getElementById('status').innerText = "download successfully";
          document.getElementById('result').innerText = res;
        }
      };

      function downloadFail(result){
        var res = "result code " + result.code;
        document.getElementById('status').innerText = "fail";
        document.getElementById('result').innerText = res;
      };

      function upload() {
        fileTransfer2 = new xFace.AdvancedFileTransfer(uploadfile,uploadServer,true);
        fileTransfer2.upload(uploadsuccess,uploadfail);
      };

      function uploadsuccess(entry) {
        isResume = false;
        alert("upload success");
      };
      function uploadfail(error) {
        if(1 == error.code){
          alert("找不到要上传的文件，请确认test_upload2.rar已经放入到SD卡和workspace下面");
        } if(2 == error.code){
          alert("url不正确，请确保url地址正确");
        }
        else {
          alert("网络错误，请确认目标服务器的地址正确或者已经打开了网络连接");
        }
      };
      function uploadpause() {
        fileTransfer2 = new xFace.AdvancedFileTransfer(uploadfile,uploadServer,true);
        fileTransfer2.pause();
      }
      function uploadCancel() {
        fileTransfer2 = new xFace.AdvancedFileTransfer(uploadfile,uploadServer,true);
        fileTransfer2.cancel();
      }
    </script>
  </head>

  <body id="stage" class="theme">
    <h1>AdvancedFileTransfer</h1>
    <div id="info">
      status: <span id="status"></span><br/>
      result: <span id="result"></span><br/>
    </div>
      <div class="btn large" onclick="download();">Download</div>
      <div class="btn large" onclick="pause();">Pause</div>
      <div class="btn large" onclick="cancel();">Cancel</div>
      <div class="btn large" data-platform="android" onclick="upload();">Upload</div>
      <div class="btn large" data-platform="android" onclick="uploadpause();">Upload Pause</div>
      <div class="btn large" data-platform="android" onclick="uploadCancel();">Upload Cancel</div>
      <h2> </h2><div class="backBtn" onclick="backHome();">Back</div>
  </body>
</html>
